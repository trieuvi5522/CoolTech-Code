// This is template code for Shelly Pro 3EM peroidly send data to MQTT broker
// ========= CONFIG =========
let CONFIG = {
 interval_s: 10, // Period to send data (seconds)
 mqtt_topic: "/template/em3", // MQTT topic to send data
 qos: 0,
 retain: false
};
// ========= MAIN =========
function publishEmData() {
 // Skip if MQTT topic is empty
 if (!CONFIG.mqtt_topic) return;
 // Read status of component em:0 and emdata:0
 let emStatus = Shelly.getComponentStatus("em", 0);
 let emDataStatus = Shelly.getComponentStatus("emdata", 0);
 // Package payload with 2 objects
 let payload = {
 "Instant Data": emStatus, // All instant values
 "Total Used": emDataStatus // All accumulated values
 };
 let shelly_em3_data = JSON.stringify(payload);
 // Publish to MQTT
 MQTT.publish(CONFIG.mqtt_topic, shelly_em3_data, CONFIG.qos,
CONFIG.retain);
}
// Make sure interval at least 2 seconds
if (CONFIG.interval_s < 2) {
 CONFIG.interval_s = 2;
}
// Periodic send data
Timer.set(CONFIG.interval_s * 1000, true, publishEmData, null);
// First send immediately when script start
publishEmData();
